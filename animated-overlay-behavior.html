<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="overlay-behavior.html">

<script>
(function() {
  'use strict';

  var AnimatedOverlayBehaviorImpl = {

    properties: {

      openAnimationConfig: {
        type: Object,
        value: function() {
          return {
            keyframes: [
              {opacity: 0, transform: 'translateY(100px)'},
              {opacity: 1, transform: 'translateY(0)'}
            ],
            options: {
              duration: 225,
              easing: 'cubic-bezier(0.165, 0.84, 0.44, 1)',
              fill: 'forwards'
            }
          };
        }
      },

      closeAnimationConfig: {
        type: Object,
        value: function() {
          return {
            keyframes: [
              {opacity: 1, transform: 'translateY(0)'},
              {opacity: 0, transform: 'translateY(100px)'}
            ],
            options: {
              duration: 300,
              easing: 'cubic-bezier(0.645, 0.045, 0.355, 1)',
              fill: 'forwards'
            }
          };
        }
      },

      removeOnClose: {
        type: Boolean,
        value: true
      }

    },

    listeners: {
      'overlay-opened': '__animateIn',
      'overlay-closed': '__animateOut'
    },

    __animateIn: function() {
      this.__beforeAnimate();

      requestAnimationFrame(function() {
        var config = this.openAnimationConfig;

        this._animation = this.animate(config.keyframes, config.options);
        this._animation.onfinish = function() {
          this.__afterAnimate();
          this.focus();
          this.fire('overlay-open-animation-finish');
        }.bind(this);
      }.bind(this));
    },

    __animateOut: function() {
      this.style.display = '';
      this.__beforeAnimate();

      requestAnimationFrame(function() {
        var config = this.closeAnimationConfig;

        this._animation = this.animate(config.keyframes, config.options);
        this._animation.onfinish = function() {
          this.__afterAnimate();
          if (this.removeOnClose) {
            this.remove();
          }
          this.fire('overlay-close-animation-finish');
        }.bind(this);
      }.bind(this));
    },

    __beforeAnimate() {
      document.body.style.overflow = 'hidden';
      this.style.willChange = 'transform';
    },

    __afterAnimate() {
      document.body.style.overflow = '';
      this.style.willChange = '';
      this._animation = null;
    }

  };

  window.AnimatedOverlayBehavior = [AnimatedOverlayBehaviorImpl, OverlayBehavior];

})();
</script>
